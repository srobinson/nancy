<!-- b_path:: .planning/phases/02-worker-outbound-messages/02-01-PLAN.md -->
---
phase: 02-worker-outbound-messages
plan: 01
type: execute
---

<objective>
Enable worker to send messages to orchestrator using the new bidirectional comms infrastructure.

Purpose: Workers can now report blockers, progress, and request reviews - completing the two-way communication channel.
Output: Updated skills and commands using the new comms API.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-comms-directory-redesign/01-01-SUMMARY.md
@src/comms/comms.sh
@src/cmd/direct.sh
@skills/check-directives/SKILL.md
@skills/orchestrator/SKILL.md

**From Phase 1:**
- New comms API: `comms::worker_send`, `comms::orchestrator_send`, `comms::read_inbox`, etc.
- New directory structure: `comms/{orchestrator,worker}/inbox/`
- Message types: worker (blocker, progress, review-request), orchestrator (directive, guidance, stop)

**Files needing update:**
- `src/cmd/direct.sh` - Uses old `comms::write_directive` (no longer exists)
- `skills/check-directives/SKILL.md` - Uses old path `comms/directives/`
- `skills/orchestrator/SKILL.md` - Doesn't mention reading worker messages

**New file needed:**
- `skills/send-message/SKILL.md` - Worker skill to send messages to orchestrator

**Constraint:** ZERO backward compatibility - clean break.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update cmd::direct to use new comms API</name>
  <files>src/cmd/direct.sh</files>
  <action>
Update the direct command to use the new comms API:

1. Replace `comms::write_directive` with `comms::orchestrator_send`
2. The old function signature was: `comms::write_directive "$task" "$message" "$priority" "$directive_type"`
3. New function signature is: `comms::orchestrator_send "$task" "$msg_type" "$message" "$priority"`
4. Note: msg_type comes before message in new API
5. Valid orchestrator types: directive, guidance, stop (not redirect or pause - map redirect→guidance, pause→stop)
6. Keep the CLI interface the same: `nancy direct <task> "message" [priority] [type]`
7. Add mapping: redirect → guidance (with note), pause → stop

Clean break - no backward compat needed.
  </action>
  <verify>source nancy 2>/dev/null; source src/cmd/index.sh && type cmd::direct</verify>
  <done>cmd::direct function updated to use comms::orchestrator_send</done>
</task>

<task type="auto">
  <name>Task 2: Update check-directives skill for new inbox path</name>
  <files>skills/check-directives/SKILL.md</files>
  <action>
Update the check-directives skill to use new comms structure:

1. Change path from `comms/directives/` to `comms/worker/inbox/` (directives TO worker are in worker's inbox)
2. Update archive path from `comms/archive/directives/` to use `comms::archive` function conceptually
3. Actually, for skill simplicity, just reference the new path: `comms/archive/`
4. Update directive types to match new schema: directive, guidance, stop
5. Remove redirect and pause (map in docs: redirect→guidance, pause→stop)
6. Keep skill simple - just bash commands the worker can run
  </action>
  <verify>cat skills/check-directives/SKILL.md | grep "worker/inbox"</verify>
  <done>check-directives skill updated with new inbox path and message types</done>
</task>

<task type="auto">
  <name>Task 3: Create send-message skill for workers</name>
  <files>skills/send-message/SKILL.md</files>
  <action>
Create a new skill for workers to send messages to orchestrator:

1. Create `skills/send-message/SKILL.md`
2. Skill frontmatter:
   - name: send-message
   - description: Send a message to the orchestrator. Use for blockers, progress updates, or requesting review.
3. Content should explain:
   - When to send blocker (stuck, need help)
   - When to send progress (milestone reached, significant update)
   - When to send review-request (work complete, want review)
4. Provide bash command using comms::worker_send:
   ```bash
   source "$NANCY_FRAMEWORK_ROOT/src/comms/index.sh"
   comms::worker_send "$NANCY_CURRENT_TASK" "blocker|progress|review-request" "message"
   ```
5. Keep it simple and actionable
  </action>
  <verify>test -f skills/send-message/SKILL.md && cat skills/send-message/SKILL.md | grep "worker_send"</verify>
  <done>New send-message skill created for worker → orchestrator messaging</done>
</task>

<task type="auto">
  <name>Task 4: Update orchestrator skill to check worker messages</name>
  <files>skills/orchestrator/SKILL.md</files>
  <action>
Update orchestrator skill to mention checking for worker messages:

1. Add section "## Receiving Worker Messages"
2. Explain that workers can send: blocker, progress, review-request
3. Provide command to check orchestrator inbox:
   ```bash
   ls "$NANCY_CURRENT_TASK_DIR/comms/orchestrator/inbox/"
   ```
4. Explain what to do with each type:
   - blocker: Worker needs help, consider intervening
   - progress: Informational, acknowledge if significant
   - review-request: Worker wants review of completed work
5. Add archive command after reading
6. Keep existing content about sending directives intact
  </action>
  <verify>cat skills/orchestrator/SKILL.md | grep "orchestrator/inbox"</verify>
  <done>Orchestrator skill updated to check for and handle worker messages</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `nancy direct test-task "hello"` works (after creating test-task or just source check)
- [ ] check-directives skill references `comms/worker/inbox/`
- [ ] send-message skill exists and references `comms::worker_send`
- [ ] orchestrator skill mentions checking `comms/orchestrator/inbox/`
- [ ] All skills use consistent message types
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Worker can send messages via send-message skill
- Orchestrator can receive worker messages
- Direct command uses new comms API
- Check-directives uses new inbox path
- No references to old comms structure remain in modified files
</success_criteria>

<output>
After completion, create `.planning/phases/02-worker-outbound-messages/02-01-SUMMARY.md` following summary template.

Include:
- Files updated/created
- Message flow now complete (bidirectional)
- Any deviations from plan
</output>
