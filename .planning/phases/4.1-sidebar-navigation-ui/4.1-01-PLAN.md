<!-- b_path:: .planning/phases/4.1-sidebar-navigation-ui/4.1-01-PLAN.md -->
---
phase: 4.1-sidebar-navigation-ui
plan: 01
type: execute
---

<objective>
Create navigation module with mouse-enabled menu and zoom toggle for scalable pane navigation.

Purpose: Provide the core navigation primitives that enable switching between 3+ panes with mouse support, replacing the failed gum choose approach.
Output: `src/nav/` module with `nav::show_menu` (native tmux display-menu) and `nav::toggle_zoom` functions.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/4.1-sidebar-navigation-ui/4.1-RESEARCH.md

@src/cmd/orchestrate.sh
@src/notify/index.sh

**Research findings (MUST follow):**
- Use `tmux display-menu` for navigation (native mouse support, zero dependencies)
- Use `resize-pane -Z` for zoom toggle (proven pattern)
- Do NOT use `gum choose` (no mouse support)
- Do NOT use `resize-pane` to "collapse" panes (tmux enforces minimum sizes)
- AVOID complex pane state management - simpler is better

**Prior decisions:**
- Phase 3: tmux display-message for non-blocking, display-popup for blocking
- Module loader pattern: `src/module/index.sh` sources sub-modules
- Function namespacing: `module::function()`

**Tech available:**
- tmux 3.6a (display-menu, display-popup, resize-pane -Z all available)
- fzf (available but display-menu is lighter weight for this use case)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create nav module with display-menu based navigation</name>
  <files>src/nav/nav.sh, src/nav/index.sh</files>
  <action>
Create `src/nav/` module following existing module patterns:

1. Create `src/nav/index.sh`:
   - Sources nav.sh
   - Follows pattern from src/notify/index.sh

2. Create `src/nav/nav.sh` with:
   - `nav::show_menu` - Shows tmux display-menu with pane options
     - Uses `tmux display-menu` (native mouse support, zero deps)
     - Lists: Worker, Orchestrator, Inbox (configurable via args or discovers from panes)
     - Each option runs `select-pane -t N`
     - Includes "Zoom Current" option that runs `resize-pane -Z`
     - Position at center (-x C -y C) for visibility
     - Keyboard shortcuts: 1,2,3 for panes, z for zoom, q for cancel

   - `nav::zoom_pane` - Toggle zoom on specified pane
     - Accepts optional pane target (defaults to current)
     - Uses `resize-pane -Z` directly (simple, proven)
     - Shows brief display-message to confirm state

   - `nav::is_zoomed` - Check if window is currently zoomed
     - Returns 0 if zoomed, 1 if not
     - Uses `tmux display-message -p '#{window_zoomed_flag}'`

Follow existing code style: function namespacing, early returns, log:: for errors.

Do NOT use gum choose - research confirmed it has no mouse support.
Do NOT try to "hide" panes with resize-pane - research confirmed minimum size is 1 row/col.
  </action>
  <verify>
source src/nav/index.sh && type nav::show_menu && type nav::zoom_pane && type nav::is_zoomed
  </verify>
  <done>
- nav module exists with index.sh and nav.sh
- nav::show_menu function defined
- nav::zoom_pane function defined
- nav::is_zoomed function defined
- Functions follow project conventions
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate nav module into nancy entry point</name>
  <files>nancy</files>
  <action>
Update the main `nancy` script to source the nav module:

1. Add source line for nav module after other module sources:
   - Pattern: `source "$NANCY_FRAMEWORK_ROOT/src/nav/index.sh"`
   - Place after existing module sources (core, config, task, cli, comms, cmd)

2. Add internal command `_nav` to main() case statement:
   - Routes to `nav::show_menu "$@"`
   - This allows testing via `nancy _nav`

Do NOT modify any other behavior. Keep changes minimal.
  </action>
  <verify>
grep -q "src/nav/index.sh" nancy && grep -q "_nav" nancy
  </verify>
  <done>
- nancy sources src/nav/index.sh
- `nancy _nav` command available for testing
- No other changes to nancy behavior
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `source src/nav/index.sh` works without errors
- [ ] `nav::show_menu`, `nav::zoom_pane`, `nav::is_zoomed` are defined
- [ ] `nancy _nav` executes without syntax errors (will fail if not in tmux, that's ok)
- [ ] Code follows project conventions (namespacing, logging)
</verification>

<success_criteria>
- All tasks completed
- nav module created with required functions
- Module integrated into nancy entry point
- Functions use native tmux features (display-menu, resize-pane -Z)
- No gum dependencies added
- No complex pane state management introduced
</success_criteria>

<output>
After completion, create `.planning/phases/4.1-sidebar-navigation-ui/4.1-01-SUMMARY.md`
</output>
