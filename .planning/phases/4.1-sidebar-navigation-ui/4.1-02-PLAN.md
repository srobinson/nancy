<!-- b_path:: .planning/phases/4.1-sidebar-navigation-ui/4.1-02-PLAN.md -->
---
phase: 4.1-sidebar-navigation-ui
plan: 02
type: execute
---

<objective>
Integrate navigation into orchestration layout with zoom-focused workflow and unread indicators.

Purpose: Transform the fixed 3-pane layout into a zoom-based navigation system where users focus on one pane at a time with easy switching.
Output: Updated orchestrate.sh with zoom-based layout, unread indicator in pane borders, working navigation.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/4.1-sidebar-navigation-ui/4.1-RESEARCH.md
@.planning/phases/4.1-sidebar-navigation-ui/4.1-01-SUMMARY.md

@src/cmd/orchestrate.sh
@src/nav/nav.sh
@src/nav/index.sh

**Research findings (MUST follow):**
- Use `resize-pane -Z` to zoom Worker pane on startup (focus pattern)
- Status line or pane border for unread indicators (simpler than sidebar)
- Native tmux features, avoid external dependencies
- Keep layout simple - zoom handles "scaling" to any number of panes

**Prior decisions:**
- Phase 3: tmux display-popup for urgent messages (70% x 40%)
- Phase 3: fswatch for inbox monitoring
- Phase 4.1-01: nav module created with show_menu, zoom_pane, is_zoomed

**Tech available:**
- nav::show_menu for pane switching
- nav::zoom_pane for zoom toggle
- tmux 3.6a (display-menu with mouse, resize-pane -Z)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update orchestrate.sh with zoom-based startup</name>
  <files>src/cmd/orchestrate.sh</files>
  <action>
Modify cmd::orchestrate to use zoom-based workflow:

1. After creating panes and setting titles, zoom Worker pane:
   - Add: `tmux resize-pane -t "$win.1" -Z`
   - This makes Worker fill the window on startup (focused workflow)
   - Users can unzoom (prefix + z) or use nav menu to switch

2. Add navigation hint to Worker pane title:
   - Change: `"‚öôÔ∏è Worker: ${task}"` ‚Üí `"‚öôÔ∏è Worker: ${task} [prefix+z: menu]"`
   - Or add tmux display-message after startup: "Navigation: prefix+z to unzoom, then select pane"

3. Optionally bind nav::show_menu to a key in this window:
   - `tmux bind-key -T prefix n run-shell "$NANCY_FRAMEWORK_ROOT/nancy _nav"`
   - This gives prefix+n for navigation menu (in addition to prefix+z for zoom)

Keep the existing 3-pane structure. Zoom is additive, not replacing the layout.
Do NOT change the fundamental pane arrangement.
  </action>
  <verify>
grep -q "resize-pane.*-Z" src/cmd/orchestrate.sh
  </verify>
  <done>
- orchestrate.sh zooms Worker pane on startup
- Navigation hint visible in pane title or via display-message
- Optional: prefix+n bound to nav menu
- Existing layout preserved (just zoomed on start)
  </done>
</task>

<task type="auto">
  <name>Task 2: Add unread indicator to pane borders</name>
  <files>src/cmd/orchestrate.sh</files>
  <action>
Add unread indicator to the Inbox pane border format:

1. Create helper script or function for unread check:
   - Check if files exist in `$NANCY_TASK_DIR/comms/orchestrator/inbox/`
   - Return indicator string: `[NEW]` if files present, empty otherwise

2. Update pane-border-format to include dynamic indicator:
   - Option A (simpler): Use static format, rely on watcher to update pane title
   - Option B (dynamic): Use format with shell command `#(script)` - but this requires script to be in PATH

   Recommended: Option A - Update Inbox pane title when messages arrive (via existing watcher)
   - Modify _logs command or watcher to: `tmux select-pane -t "$WIN.2" -T "üì¨ Inbox [NEW]"` when files arrive
   - Reset to `"üì¨ Inbox"` when cleared

3. Alternative: Add to window status line (visible in tmux bar):
   - `tmux set-option -t "$win" status-right "#(check_inbox_script) %H:%M"`
   - This shows indicator without needing to modify pane borders

Choose the simplest approach that works. Dynamic pane titles are simpler than status-right scripts.
  </action>
  <verify>
grep -qE "(Inbox.*NEW|unread|check_inbox)" src/cmd/orchestrate.sh || grep -qE "select-pane.*-T.*NEW" src/cmd/internal.sh
  </verify>
  <done>
- Unread indicator mechanism implemented
- Either: Inbox pane title updates to show [NEW] when messages arrive
- Or: Window status shows unread indicator
- Indicator is visible during orchestration workflow
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Navigation module and zoom-based orchestration layout with unread indicators</what-built>
  <how-to-verify>
1. Start orchestration: `nancy orchestrate <task>` (must be in tmux)
2. Verify Worker pane is zoomed (fills window) on startup
3. Press `prefix + z` to unzoom - should see all 3 panes
4. Test navigation:
   - Run `nancy _nav` in any pane - should see tmux menu with pane options
   - Click a pane name with mouse - should switch to that pane
   - Press keyboard shortcut (1,2,3) - should also switch panes
5. Test zoom toggle:
   - Press `prefix + z` to zoom current pane
   - Press again to unzoom
6. Test unread indicator:
   - Create a test file in comms/orchestrator/inbox/
   - Check if Inbox pane title or status shows [NEW] or similar
7. Verify no errors in any pane

Expected behavior:
- Smooth navigation between panes
- Mouse clicks work in navigation menu
- Zoom toggle works
- Unread indicator visible when messages present
  </how-to-verify>
  <resume-signal>Type "approved" if navigation works with mouse and zoom, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] orchestrate.sh zooms Worker on startup
- [ ] Navigation menu accessible (via _nav command or keybinding)
- [ ] Mouse clicks work in navigation menu
- [ ] Zoom toggle works (prefix + z)
- [ ] Unread indicator visible somewhere (title or status)
- [ ] Human verification passed
</verification>

<success_criteria>
- All tasks completed
- Human verification approved
- Zoom-based workflow functional
- Navigation menu has mouse support (not gum choose)
- Unread indicators visible
- Phase 4.1 complete - scalable sidebar navigation implemented
</success_criteria>

<output>
After completion, create `.planning/phases/4.1-sidebar-navigation-ui/4.1-02-SUMMARY.md`
</output>
