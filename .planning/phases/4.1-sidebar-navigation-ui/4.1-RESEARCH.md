<!-- b_path:: .planning/phases/4.1-sidebar-navigation-ui/4.1-RESEARCH.md -->
# Phase 4.1: Sidebar Navigation UI - Research

**Researched:** 2026-01-14
**Domain:** tmux pane management, navigation UI, terminal mouse interaction
**Confidence:** HIGH

<research_summary>
## Summary

Researched tmux pane management techniques for building a scalable sidebar navigation UI. The key findings explain why the initial prototype failed and identify several viable approaches.

**Critical discoveries:**
1. `resize-pane` cannot hide panes - tmux enforces minimum 1 row/column
2. `gum choose` does NOT support mouse clicks - it's keyboard-only by design
3. tmux-sidebar works by creating/destroying panes, not hiding them
4. `fzf` supports full mouse interaction (click, double-click, shift-click)
5. tmux 3.6a supports `display-popup` and `display-menu` with native mouse

**Primary recommendation:** Use popup-based navigation with fzf for mouse support, or zoom-based approach for simplicity. Avoid gum choose for mouse-interactive UIs.
</research_summary>

<standard_stack>
## Standard Stack

### Core (Already Available)
| Tool | Version | Purpose | Why Standard |
|------|---------|---------|--------------|
| tmux | 3.6a | Terminal multiplexer | Current version, full feature support |
| fzf | latest | Fuzzy finder | Mouse support, tmux popup integration |
| bash | 5.x | Shell scripting | Already in use for Nancy |

### Alternatives to gum choose
| Tool | Mouse Support | tmux Integration | Use Case |
|------|---------------|------------------|----------|
| fzf | YES (click, shift-click) | --tmux popup | Navigation menus |
| tmux display-menu | YES (native) | Native | Simple menus, right-click |
| tmux display-popup + fzf | YES | Native popup | Complex selection with preview |
| gum choose | NO | None | Keyboard-only scenarios |

### tmux Features Required
| Feature | tmux Version | Our Version | Status |
|---------|--------------|-------------|--------|
| display-popup | 3.2+ | 3.6a | Available |
| display-menu | 3.0+ | 3.6a | Available |
| fzf --tmux popup | 3.3+ | 3.6a | Available |
| resize-pane -Z (zoom) | 1.8+ | 3.6a | Available |

**Installation:**
fzf is likely already installed. If not:
```bash
brew install fzf
```
</standard_stack>

<architecture_patterns>
## Architecture Patterns

### Pattern 1: Zoom-Based Navigation (Simplest)
**What:** Use `resize-pane -Z` to zoom active pane, hiding others
**When to use:** Simple 2-3 pane layouts, keyboard-driven workflow
**Pros:** Zero dependencies, instant, preserves all pane state
**Cons:** Can only show one pane at a time, no true sidebar

```bash
# Toggle zoom on current pane (hides/shows others)
tmux resize-pane -Z

# Zoom specific pane
tmux resize-pane -t "${WIN}.${PANE}" -Z
```

### Pattern 2: Popup-Based Navigation (Recommended for Mouse)
**What:** Press hotkey to show fzf popup for pane/view selection
**When to use:** Mouse-interactive UIs, 3+ views to switch between
**Pros:** Mouse support, fuzzy search, preview capability
**Cons:** Requires fzf, popup overlays content

```bash
# Navigation popup with fzf
tmux display-popup -E -w 50% -h 40% '
  echo -e "Worker\nOrchestrator\nInbox" |
  fzf --prompt="Switch to: " |
  xargs -I{} tmux select-pane -t {}
'
```

### Pattern 3: Native display-menu (Lightest Weight)
**What:** Use tmux's built-in menu system with mouse support
**When to use:** Simple menus, right-click context menus
**Pros:** Zero dependencies, native mouse, instant
**Cons:** Limited styling, no fuzzy search

```bash
# Simple navigation menu
tmux display-menu -x P -y P \
  "Worker"      w "select-pane -t 0" \
  "Orchestrator" o "select-pane -t 1" \
  "Inbox"       i "select-pane -t 2" \
  "" \
  "Cancel"      q ""
```

### Pattern 4: Window-Based (True Isolation)
**What:** Each "view" is a separate tmux window, sidebar shows window list
**When to use:** Views with different layouts, need true isolation
**Pros:** Each view can have own layout, no resize issues
**Cons:** More complex state management, window switching overhead

```bash
# Create separate windows
tmux new-window -n "worker"
tmux new-window -n "orchestrator"
tmux new-window -n "inbox"

# Switch windows with fzf
tmux display-popup -E '
  tmux list-windows -F "#I: #W" |
  fzf --prompt="Window: " |
  cut -d: -f1 |
  xargs tmux select-window -t
'
```

### Pattern 5: Break-Pane/Join-Pane (True Hide)
**What:** Move pane to hidden window, join back when needed
**When to use:** Need to truly hide pane while preserving running process
**Pros:** Pane keeps running, truly hidden
**Cons:** Complex to manage, pane state bookkeeping required

```bash
# Hide pane to hidden window (create if needed)
tmux break-pane -d -t "hidden:"

# Restore pane from hidden window
tmux join-pane -s "hidden:0"
```

### Anti-Patterns to Avoid
- **resize-pane to "collapse":** tmux enforces minimum dimensions, doesn't work
- **gum choose for mouse UIs:** No mouse support, keyboard only
- **Custom mouse handling:** Let tmux/fzf handle mouse events natively
</architecture_patterns>

<dont_hand_roll>
## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Mouse-interactive menus | Custom mouse handling | fzf or tmux display-menu | Native support, tested |
| Pane hiding | resize-pane tricks | zoom or break-pane/join-pane | resize-pane can't truly hide |
| Sidebar toggle | Custom pane management | tmux-sidebar pattern (kill/join) | Battle-tested approach |
| Fuzzy selection | Manual filtering | fzf | Years of optimization |
| Popup windows | Manual pane sizing | tmux display-popup | Native, handles edge cases |

**Key insight:** tmux-sidebar doesn't "hide" panes - it destroys and recreates them. This seems wasteful but is actually the most reliable pattern because tmux doesn't support true pane hiding.
</dont_hand_roll>

<common_pitfalls>
## Common Pitfalls

### Pitfall 1: Thinking resize-pane Can Hide Panes
**What goes wrong:** Using `resize-pane -y 0` or `-x 0` expecting pane to disappear
**Why it happens:** Intuitive assumption that 0 size means hidden
**Reality:** tmux enforces minimum 1 row Ã— 1 column for any pane
**How to avoid:** Use zoom, break-pane, or window-based patterns instead
**Warning signs:** Panes show as thin strips instead of disappearing

### Pitfall 2: Expecting Mouse Clicks in gum choose
**What goes wrong:** Building UI with gum choose, mouse clicks don't work
**Why it happens:** gum choose uses Bubble Tea which supports mouse, but gum choose doesn't expose it
**Reality:** gum choose is keyboard-only (arrow keys + enter)
**How to avoid:** Use fzf for mouse-interactive selection
**Warning signs:** Users clicking but nothing happens

### Pitfall 3: Complex Pane State Management
**What goes wrong:** Tracking which panes are "hidden", restoring wrong state
**Why it happens:** break-pane/join-pane requires manual bookkeeping
**Reality:** Simple patterns (zoom, windows, popup) avoid state complexity
**How to avoid:** Prefer simpler patterns unless true hiding is required
**Warning signs:** Panes appearing in wrong positions, lost processes

### Pitfall 4: Fighting tmux Minimum Sizes
**What goes wrong:** Setting pane-base-index, minimum sizes, etc. to bypass limits
**Why it happens:** Trying to work around tmux's design
**Reality:** tmux minimum sizes are intentional - redesign the approach
**How to avoid:** Accept tmux constraints, use patterns that work with them
**Warning signs:** Spending time on tmux config tweaks that don't solve the problem
</common_pitfalls>

<code_examples>
## Code Examples

### Navigation with fzf Popup (Mouse-Enabled)
```bash
# Source: fzf official docs + tmux wiki
# Requires: tmux 3.3+, fzf

show_navigation_popup() {
  local options="Worker
Orchestrator
Inbox
Logs"

  local selected=$(echo "$options" | fzf --tmux center,40%,30% \
    --prompt="Switch to: " \
    --no-info \
    --reverse)

  case "$selected" in
    "Worker") tmux select-pane -t 0 ;;
    "Orchestrator") tmux select-pane -t 1 ;;
    "Inbox") tmux select-pane -t 2 ;;
    "Logs") tmux select-pane -t 3 ;;
  esac
}
```

### Native tmux Menu (Zero Dependencies)
```bash
# Source: tmux man page
# No external dependencies

show_navigation_menu() {
  tmux display-menu -T "#[align=centre]Navigation" -x C -y C \
    "Worker"       1 "select-pane -t 0" \
    "Orchestrator" 2 "select-pane -t 1" \
    "Inbox"        3 "select-pane -t 2" \
    "" \
    "Zoom Current" z "resize-pane -Z" \
    "Cancel"       q ""
}
```

### Zoom Toggle with Indicator
```bash
# Source: tmux wiki - zoom pattern

toggle_zoom() {
  local pane="$1"

  # Check if already zoomed
  local zoomed=$(tmux display-message -p '#{window_zoomed_flag}')

  if [[ "$zoomed" == "1" ]]; then
    tmux resize-pane -Z  # Unzoom
    tmux display-message "Restored layout"
  else
    tmux resize-pane -t "$pane" -Z  # Zoom
    tmux display-message "Zoomed: $pane"
  fi
}
```

### Unread Indicator in Status Line
```bash
# Source: tmux status line format

# Check for unread messages
check_unread() {
  local inbox="$TASK_DIR/comms/orchestrator/inbox"
  if [[ -n "$(ls -A "$inbox" 2>/dev/null)" ]]; then
    echo "[NEW]"
  fi
}

# Add to tmux status line
tmux set-option -g status-right "#(check_unread) %H:%M"
```

### Break-Pane Hide Pattern
```bash
# Source: tmux wiki + community patterns
# For true hiding with process preservation

hide_pane() {
  local pane_id="$1"

  # Create hidden window if doesn't exist
  tmux list-windows -F '#W' | grep -q '^hidden$' || \
    tmux new-window -d -n "hidden"

  # Break pane to hidden window
  tmux break-pane -d -s "$pane_id" -t "hidden:"
}

show_pane() {
  local target_pane="$1"

  # Join first pane from hidden window
  tmux join-pane -s "hidden:0.0" -t "$target_pane"
}
```
</code_examples>

<sota_updates>
## State of the Art (2025-2026)

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| fzf-tmux script | fzf --tmux flag | fzf 0.40+ (2023) | Native integration, simpler |
| Manual popup sizing | display-popup | tmux 3.2 (2021) | Built-in popup support |
| External menu tools | display-menu | tmux 3.0 (2020) | Native menus with mouse |
| Pane minimize hacks | Zoom (resize-pane -Z) | tmux 1.8 (2013) | Stable, reliable pattern |

**New patterns to consider:**
- **fzf --tmux popup:** Simplest way to get mouse-enabled selection in tmux
- **tmux display-popup + scripts:** Can run any command in floating window
- **Status line integration:** Unread indicators without separate pane

**Deprecated/outdated:**
- **fzf-tmux script:** Still works but --tmux flag is preferred
- **External menu tools (rofi in terminal):** tmux display-menu is simpler
- **Pane resize hacks:** Don't fight tmux, use zoom or windows
</sota_updates>

<open_questions>
## Open Questions

1. **Sidebar pane vs popup for navigation?**
   - What we know: Both work, popup is simpler
   - What's unclear: User preference for persistent sidebar vs on-demand popup
   - Recommendation: Start with popup, add sidebar later if needed

2. **Unread indicators in sidebar vs status line?**
   - What we know: Status line is simpler, sidebar requires pane
   - What's unclear: How visible status line indicators are during focused work
   - Recommendation: Status line for MVP, sidebar for polish

3. **Window-based vs pane-based layout?**
   - What we know: Windows provide true isolation, panes are visible simultaneously
   - What's unclear: Whether Nancy benefits from seeing multiple panes at once
   - Recommendation: Keep panes for now, windows if isolation needed
</open_questions>

<sources>
## Sources

### Primary (HIGH confidence)
- /junegunn/fzf (Context7) - mouse support, --tmux integration
- /tmux/tmux (Context7) - zoom, display-menu, display-popup
- tmux-sidebar source code (WebFetch) - toggle mechanism

### Secondary (MEDIUM confidence)
- [tmux wiki - Getting Started](https://github.com/tmux/tmux/wiki/Getting-Started) - pane management
- [Baeldung - How to Hide tmux Pane](https://www.baeldung.com/linux/tmux-pane-hide) - break-pane pattern
- [DeepWiki - tmux Popups and Menus](https://deepwiki.com/tmux/tmux/5.2-popups-and-menus) - popup details

### Tertiary (LOW confidence - needs validation)
- gum choose mouse support (WebSearch) - confirmed NO mouse support
- tmux minimum pane size (WebSearch) - confirmed 1 row/column minimum
</sources>

<metadata>
## Metadata

**Research scope:**
- Core technology: tmux pane management
- Ecosystem: fzf, gum, tmux plugins
- Patterns: zoom, popup, window-based, break-pane/join-pane
- Pitfalls: resize-pane limits, gum mouse, state complexity

**Confidence breakdown:**
- Standard stack: HIGH - verified with Context7, official docs
- Architecture patterns: HIGH - multiple approaches validated
- Pitfalls: HIGH - explains exact prototype failure
- Code examples: HIGH - from official sources and verified patterns

**Research date:** 2026-01-14
**Valid until:** 2026-02-14 (30 days - tmux ecosystem stable)
</metadata>

---

*Phase: 4.1-sidebar-navigation-ui*
*Research completed: 2026-01-14*
*Ready for planning: yes*
